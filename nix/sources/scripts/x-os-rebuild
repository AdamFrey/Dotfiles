#!/usr/bin/env bb

(require '[babashka.process :refer [sh shell]])
(require '[clojure.string :as string])

(defn hostname
  []
  (-> (sh "hostname")
      (:out)
      (string/trim)))

(defn flake-path
  []
  (case (hostname)
    "matte-black-cadillac"   "/home/adam/src/dotfiles/nix#desktop"
    "stylitics-laptop-nixos" "/home/adam/src/dotfiles/nix#laptop"))

(try
  (shell "sudo nixos-rebuild switch --flake" (flake-path))
  (catch Exception _
    (System/exit 1)))

(System/exit 0)
